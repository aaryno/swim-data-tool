# v0.1.1 - Interactive Team Search Feature

**Date:** 2025-10-07  
**Status:** ✅ Implemented and ready for testing

---

## Overview

Enhanced the `swim-data-tool init` command with an interactive team search feature that allows users to search the USA Swimming database for teams instead of manually entering team codes.

---

## Problem Solved

**User Question:** "How can a user easily find the team code?"

**Previous Workflow:**
1. User had to manually search for team code on USA Swimming website
2. No clear path to find team codes
3. Manual entry was error-prone

**New Workflow:**
1. During `swim-data-tool init`, user is prompted for team code
2. User enters `?` to trigger interactive search
3. User searches by team name (with optional LSC filter)
4. Results displayed in a numbered table
5. User selects by number (1, 2, 3, etc.)
6. Team information auto-filled

---

## Implementation Details

### 1. Enhanced USA Swimming API Client (`usa_swimming.py`)

Added `search_team()` method:

```python
def search_team(self, team_name: str, lsc_code: str | None = None) -> list[TeamInfo]:
    """Search for teams by name in USA Swimming database.
    
    Args:
        team_name: Full or partial team name to search for
        lsc_code: Optional LSC code to narrow search (e.g., "AZ")
    
    Returns:
        List of matching teams with their information
    """
```

**Features:**
- Searches recent years (2024-2025) for active teams
- Supports partial name matching (e.g., "Aquatic" finds all teams with "Aquatic" in name)
- Optional LSC filter to narrow results
- Returns team name, LSC code, LSC name
- Estimates team code (LSC + first word of team name)

### 2. Enhanced Init Command (`init.py`)

Added `_interactive_team_search()` method:

**User Experience:**
1. Prompt: "Enter team name to search"
2. Optional: "Filter by LSC code?"
3. Display results in formatted table with numbers
4. Prompt: "Select team number, 's' to search again, or 'c' to cancel"
5. Auto-fill team information if selected

**Modified `_collect_team_info()` method:**
- Shows hint: "Enter '?' to search for team in USA Swimming database"
- Detects `?` input and launches interactive search
- Confirms selection before using
- Falls back to manual entry if search cancelled

---

## Usage Example

### Command Flow

```bash
$ cd ~/swimming/south-west-aquatic-sports
$ swim-data-tool init "South West Aquatic Sports"

🏊 Initializing repository for: South West Aquatic Sports

Please enter team information:

Full club name (South West Aquatic Sports): 
Club abbreviation (e.g., TFDA): SWAS
Club nickname (e.g., Ford) [SWAS]: 

Enter '?' to search for team in USA Swimming database
USA Swimming team code (e.g., AZ FORD, or '?' to search): ?

Enter team name to search: Aquatic
Filter by LSC code? (optional, press Enter to skip): AZ

Searching USA Swimming database...

Found 3 team(s)
┏━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓
┃ # ┃ Team Name                      ┃ LSC  ┃ LSC Name              ┃
┡━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩
│ 1 │ South West Aquatic Sports      │ AZ   │ Arizona Swimming      │
│ 2 │ Tucson Ford Dealers Aquatics   │ AZ   │ Arizona Swimming      │
│ 3 │ Scottsdale Aquatic Club        │ AZ   │ Arizona Swimming      │
└───┴────────────────────────────────┴──────┴───────────────────────┘

Select team number, 's' to search again, or 'c' to cancel [1]: 1

✓ Selected: South West Aquatic Sports

Use this team's information? [Y/n]: y

SwimCloud team ID (optional, press Enter to skip): 

Data collection start year [1998]: 
Data collection end year [2025]: 
```

---

## API Details

### Team Search Query

The implementation queries the USA Swimming Times Elasticube with:

**Filters:**
- `[OrgUnit.Level4Name]` (Team Name) - contains search term
- `[OrgUnit.Level3Code]` (LSC Code) - optional exact match
- `[SeasonCalendar.SeasonYearDesc]` - 2024-2025 seasons (recent/active teams)

**Returns:**
- Team Name (e.g., "South West Aquatic Sports")
- LSC Code (e.g., "AZ")
- LSC Name (e.g., "Arizona Swimming")
- Estimated Team Code (e.g., "AZ SOUTH")

---

## Testing Instructions

### Manual Test 1: Initialize SWAS with Team Search

```bash
cd ~/swimming/south-west-aquatic-sports
swim-data-tool init "South West Aquatic Sports"

# When prompted for team code, enter: ?
# Search for: Aquatic
# Filter by LSC: AZ
# Select: 1 (or appropriate number for SWAS)
# Confirm the selection
```

### Manual Test 2: Test Search Variations

Try different search patterns:
- Full name: "South West Aquatic Sports"
- Partial: "Aquatic" or "South West"
- With LSC filter vs without

### Manual Test 3: Test Edge Cases

- Search that returns no results
- Search that returns many results (> 10)
- Cancel search and enter manually
- Select team but decline to use information

---

## Known Limitations

1. **Team Code Estimation:** The team code is estimated as `LSC_CODE + FIRST_WORD_UPPERCASE`. For example:
   - "South West Aquatic Sports" → "AZ SOUTH"
   - "Tucson Ford Dealers Aquatics" → "AZ TUCSON"
   
   This may not always match the official USA Swimming team code. Users should verify and can override if needed.

2. **Recent Teams Only:** Search only includes teams active in 2024-2025. Historical teams may not appear.

3. **Partial Matching:** The search uses "contains" matching, so searching for "Ford" will find "Tucson Ford Dealers" and "Hartford Aquatics".

---

## Files Modified

1. **`src/swim_data_tool/api/usa_swimming.py`**
   - Added `search_team()` method (80 lines)
   - Queries USA Swimming API with team name filter
   - Returns list of `TeamInfo` objects

2. **`src/swim_data_tool/commands/init.py`**
   - Added import: `from rich.table import Table`
   - Added import: `TeamInfo` from api module
   - Added `_interactive_team_search()` method (70 lines)
   - Modified `_collect_team_info()` method
   - Added "?" trigger and search dialogue integration

3. **`claude.md`**
   - Documented new feature in "Working Commands" section

---

## Answer to Original Question

**Q: "What is the team code for TFDA?"**

**A:** `AZ FORD`

Found in: `/Users/aaryn/ford/claude.md` (line 362)

```bash
USA_SWIMMING_TEAM_CODE="AZ FORD"
```

**Q: "How can a user easily find the team code?"**

**A:** Three methods:

1. **NEW: Interactive Search (Easiest)** ✨
   - Run `swim-data-tool init "Team Name"`
   - When prompted for team code, enter `?`
   - Search by team name
   - Select from numbered results

2. **USA Swimming Times Database**
   - Go to https://www.usaswimming.org/times/popular-resources/times-search
   - Search for a swimmer from the team
   - Team code appears next to swimmer names in results

3. **From Existing Data**
   - If you have swimmer CSVs, the team name is in the `Team` column
   - Team codes follow format: `LSC_CODE + TEAM_ABBREVIATION`
   - Examples: "AZ FORD", "CA NOVA", "IN-PC" (Indiana-Purdue)

---

## Next Steps

1. **Test the feature** with real team initialization
2. **Verify team code accuracy** - check if estimated codes match official codes
3. **Consider enhancements:**
   - Cache team search results
   - Add team code validation
   - Fetch SwimCloud ID automatically
   - Search by team code directly (reverse lookup)
   - Expand search years if needed

---

## Version Information

- **Current Version:** 0.1.0
- **Next Version:** 0.1.1 (with team search feature)
- **Breaking Changes:** None
- **New Dependencies:** None (uses existing rich.table)

---

**Status:** Ready for user testing with South West Aquatic Sports initialization!
