# v0.6.0 Release Summary - Gender Support

**Date:** 2025-10-07  
**Type:** Minor Feature Release (Breaking Changes)

## Overview

Version 0.6.0 adds comprehensive gender support across all commands, enabling proper separation of boys/girls records as per USA Swimming standards. This is a **breaking change** for record generation - records are now split by gender into separate files.

## What's New

### Gender Data Collection
- `roster` command now fetches gender for all swimmers from USA Swimming's Public Person Search datasource
- Gender information displayed in roster preview table with gender statistics
- New `USASwimmingAPI.get_gender_for_persons()` method for batch gender lookups (batches of 50)

### Gender Preservation
- `import swimmers` now preserves Gender column when downloading swimmer CSVs
- Gender data flows through the entire pipeline from roster ‚Üí import ‚Üí records

### Gender-Split Records
All record generation commands now create separate boys/girls outputs:

**`generate records`**
- Creates `data/records/{course}/records-boys.md`
- Creates `data/records/{course}/records-girls.md`
- Shows gender statistics and split counts during generation

**`generate top10`**
- Creates separate directories:
  - `data/records/top10/{course}/boys/`
  - `data/records/top10/{course}/girls/`
- Each event has separate boys/girls markdown files

**`generate annual`**
- Creates separate season summaries:
  - `data/records/annual/{year}-{course}-boys.md`
  - `data/records/annual/{year}-{course}-girls.md`
- Compares against gender-specific all-time records

### Backwards Compatibility
- If Gender column is missing from data, commands fall back to generating combined (legacy) records
- No breaking changes for teams that haven't re-fetched roster/imported with gender data
- Clear messaging when operating in legacy mode

## Technical Implementation

### API Changes
```python
# New method in USASwimmingAPI
def get_gender_for_persons(self, person_keys: list[int]) -> dict[int, str]:
    """Batch fetch gender using Public Person Search datasource."""
    # Processes in batches of 50 to avoid API limits
    # Returns {"M" or "F"} mapping
```

### Service Changes
```python
# New method in RecordGenerator
def filter_by_gender(self, df: pd.DataFrame, gender: str) -> pd.DataFrame:
    """Filter swims by gender ("M" or "F")."""
```

### Command Updates
- `RosterCommand`: Calls `get_gender_for_persons()` after roster fetch
- `ImportSwimmersCommand`: Creates gender_map from roster, adds Gender column to each CSV
- `GenerateRecordsCommand`: Detects gender data, loops through boys/girls
- `GenerateTop10Command`: Detects gender data, creates subdirectories
- `GenerateAnnualCommand`: Detects gender data, generates separate summaries

## Breaking Changes

‚ö†Ô∏è **Record file structure has changed:**

### Before (v0.5.x)
```
data/records/
  scy/
    records.md          # Combined boys/girls
  lcm/
    records.md
```

### After (v0.6.0)
```
data/records/
  scy/
    records-boys.md     # Boys only
    records-girls.md    # Girls only
  lcm/
    records-boys.md
    records-girls.md
```

**Migration Path:**
1. Run `swim-data-tool roster` to fetch roster with gender
2. Run `swim-data-tool import swimmers` to re-download all CSVs with gender
3. Run `swim-data-tool generate records` to create new gender-split files
4. Delete old combined `records.md` files if desired

## Usage Examples

### Fetch Roster with Gender
```bash
# Gender automatically fetched for all swimmers
swim-data-tool roster --seasons=all

# Output shows:
#   ‚úì Found 772 swimmers
#   ‚úì Gender data: 385 males, 387 females
```

### Import with Gender Preservation
```bash
# Gender automatically added to downloaded CSVs
swim-data-tool import swimmers

# Each CSV now includes a Gender column (M/F)
```

### Generate Gender-Split Records
```bash
# Automatically detects gender and creates split files
swim-data-tool generate records

# Output shows:
#   üë• Gender split: 12,543 male swims, 14,892 female swims
#   
#   üìä Generating SCY records...
#     ‚úì Boys: 156 records
#       Generated: data/records/scy/records-boys.md
#     ‚úì Girls: 168 records
#       Generated: data/records/scy/records-girls.md
```

## Testing

All existing tests pass. Gender support gracefully handles missing data by falling back to combined records mode.

## Next Steps

Consider for future releases:
- Gender-specific relay parsing (identify relay participants by gender)
- Gender validation/correction command for mismatched data
- Configuration option to force combined mode even with gender data
- Historical re-import tool to add gender to existing CSVs

## Files Changed

### Core Implementation
- `src/swim_data_tool/api/usa_swimming.py` - Added `get_gender_for_persons()`
- `src/swim_data_tool/commands/roster.py` - Gender fetch and display
- `src/swim_data_tool/commands/import_swimmers.py` - Gender preservation
- `src/swim_data_tool/services/record_generator.py` - Added `filter_by_gender()`
- `src/swim_data_tool/commands/generate.py` - Gender-split logic for all 3 commands

### Documentation
- `VERSION` ‚Üí 0.6.0
- `pyproject.toml` ‚Üí version 0.6.0
- `CHANGELOG.md` ‚Üí Added v0.6.0 section with breaking changes notice
- `claude.md` ‚Üí Updated current version and version history

### Artifacts
- `artifacts/v0.6.0-release-summary.md` (this file)

---

**Status:** ‚úÖ Complete and ready for release

