# v0.5.0 Implementation Plan

**Target Release:** v0.5.0  
**Status:** Planning → In Progress  
**Date:** 2025-10-07

---

## Goals

Implement the remaining analysis and publishing features to complete the core swim-data-tool workflow.

## Features to Implement

### 1. Top 10 Lists (`generate top10`)

Generate top 10 all-time performer lists by event.

**Command:**
```bash
swim-data-tool generate top10 [--course=scy|lcm|scm|all]
```

**What it does:**
- Reads swimmer data from raw and processed directories
- For each event, finds the top 10 fastest times across ALL age groups
- Shows best time per swimmer (no duplicate swimmers in top 10)
- Generates markdown files per event
- Saves to `data/records/top10/{course}/{event}.md`

**Output format:**
```markdown
# 50 Freestyle - All-Time Top 10

| Rank | Time | Athlete | Age | Date | Meet |
|------|------|---------|-----|------|------|
| 1 | 19.99 | John Doe ‡ | 18 | 2023-12-15 | Winter Nationals |
| 2 | 20.12 | Jane Smith | 17 | 2024-02-18 | Sectionals |
...
```

### 2. Annual Summaries (`generate annual`)

Generate season summary with best times and new records.

**Command:**
```bash
swim-data-tool generate annual --season=2024 [--course=scy|lcm|scm|all]
```

**What it does:**
- Reads swimmer data filtered by season year
- Finds best times for that season
- Compares against existing team records to identify new records
- Highlights season improvements
- Generates markdown summary
- Saves to `data/records/annual/annual-summary-{year}.md`

**Output format:**
```markdown
# 2024 Season Summary

## New Team Records Set

### Short Course Yards (SCY)

- **50 Free, Boys 13-14**: 21.45 by John Doe (previous: 21.89)
- **100 Back, Girls 15-16**: 54.32 by Jane Smith (previous: 55.12)

## Best Times of the Season

### Boys 13-14
- **50 Free**: 21.45 - John Doe - State Championships
...
```

### 3. Publish Command (`publish`)

Publish records to public GitHub repository.

**Command:**
```bash
swim-data-tool publish [--dry-run]
```

**What it does:**
- Reads PUBLIC_REPO_URL and PUBLIC_REPO_LOCAL from .env
- Clones/updates public repository
- Copies records from `data/records/` to public repo
- Commits with timestamp
- Pushes to GitHub
- `--dry-run`: shows what would be published without making changes

**Requirements:**
- Git must be installed
- SSH keys configured for GitHub
- PUBLIC_REPO_URL set in .env

---

## Implementation Order

### Phase 1: Top 10 Lists ✅
1. Extend `record_generator.py` with `get_top_n_by_event()` method
2. Add markdown generation for top 10 format
3. Create `generate top10` CLI command
4. Test with real data

### Phase 2: Annual Summaries
1. Add season filtering to record generator
2. Implement record comparison logic
3. Create annual summary markdown template
4. Create `generate annual` CLI command
5. Test with multiple seasons

### Phase 3: Publish Command
1. Create `PublishCommand` class
2. Implement git operations (clone, copy, commit, push)
3. Add dry-run mode
4. Create `publish` CLI command
5. Test with test repository

### Phase 4: Documentation & Release
1. Update VERSION to 0.5.0
2. Update CHANGELOG.md
3. Update README.md
4. Update claude.md
5. Create release summary
6. Tag and push

---

## Technical Details

### Top 10 Generation

**Logic:**
1. Load all swimmer data
2. Parse and normalize events
3. Group by course and event
4. Sort by time (all age groups combined)
5. Keep best time per swimmer
6. Take top 10
7. Generate markdown

**File structure:**
```
data/records/top10/
├── scy/
│   ├── 50-free.md
│   ├── 100-free.md
│   └── ...
├── lcm/
│   └── ...
└── scm/
    └── ...
```

### Annual Summary

**Logic:**
1. Load all swimmer data
2. Filter by season (SwimDate year = season)
3. Find best times for season
4. Load existing records from `data/records/{course}/records.md`
5. Compare season bests against records
6. Identify new records
7. Generate summary

**Season definition:**
- SCY season: September Year-1 through August Year
- LCM season: January Year through December Year
- Configurable in .env (optional)

### Publish Workflow

**Steps:**
1. Check for PUBLIC_REPO_URL in .env
2. Clone repo if not exists, pull if exists
3. Copy all files from `data/records/` to public repo
4. Git add all changes
5. Commit with message: "Update records - {timestamp}"
6. Push to origin main
7. Report success/failure

**Safety:**
- Always pull before push to avoid conflicts
- Use --dry-run to preview changes
- Require explicit confirmation (unless --yes flag)

---

## Testing Strategy

### Top 10 Lists
- Test with swimmers having same times (tie handling)
- Test with fewer than 10 swimmers in event
- Test with missing data for some events
- Verify best-per-swimmer logic works

### Annual Summaries
- Test with season having new records
- Test with season having no new records
- Test with incomplete season data
- Verify date filtering accuracy

### Publish
- Test with non-existent repo (fresh clone)
- Test with existing repo (pull + push)
- Test dry-run mode
- Test with no changes (clean push)
- Test with git conflicts

---

## Dependencies

All dependencies already available:
- pandas (data processing)
- rich (CLI output)
- click (CLI framework)
- git (external, user-installed)

No new dependencies needed!

---

## Success Criteria

- ✅ `generate top10` creates markdown files for all events
- ✅ `generate annual --season=2024` creates season summary
- ✅ `publish` successfully pushes to GitHub
- ✅ All commands have Next Steps panels
- ✅ All commands have consistent UX
- ✅ Documentation updated
- ✅ Tests pass
- ✅ v0.5.0 tagged and released

---

**Created:** 2025-10-07  
**Target Completion:** Today!
