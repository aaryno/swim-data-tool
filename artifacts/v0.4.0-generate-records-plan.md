# v0.4.0 - Generate Records Implementation Plan

**Goal:** Generate team records from processed swim data

**Status:** Planning → In Progress

---

## Overview

This is THE main feature - transforming raw swim data into beautiful, readable team records.

## Features to Implement

### 1. Generate Records Command

```bash
swim-data-tool generate records [--course=scy|lcm|scm|all]
```

**What it does:**
- Reads swimmer CSVs from `data/raw/swimmers/` and `data/processed/`
- Determines which swims count for records (team + probationary)
- Groups by course, age group, event
- Finds best time for each swimmer in each category
- Generates markdown files with top times
- Saves to `data/records/{course}/`

### 2. Generate Top 10 Command

```bash
swim-data-tool generate top10 [--course=scy|lcm|scm|all]
```

**What it does:**
- Top 10 all-time performances by event
- Across all age groups
- Saves to `data/records/{course}/top10-{event}.md`

### 3. Generate Annual Summary

```bash
swim-data-tool generate annual --season=2025
```

**What it does:**
- Best times from specific season
- New records set
- Season highlights
- Saves to `data/records/annual-summary-{year}.md`

---

## Data Structure

### Age Groups (USA Swimming Standard)
- 10 & Under
- 11-12
- 13-14
- 15-16
- 17-18
- Open (all ages)

### Events by Course

**SCY (Short Course Yards):**
- Freestyle: 50, 100, 200, 500, 1000, 1650
- Backstroke: 50, 100, 200
- Breaststroke: 50, 100, 200
- Butterfly: 50, 100, 200
- IM: 100, 200, 400

**LCM (Long Course Meters):**
- Freestyle: 50, 100, 200, 400, 800, 1500
- Backstroke: 50, 100, 200
- Breaststroke: 50, 100, 200
- Butterfly: 50, 100, 200
- IM: 200, 400

**SCM (Short Course Meters):**
- Same as LCM

### Record Categories
- Age group records (e.g., 13-14 Boys 100 FR SCY)
- Open records (best ever in event)
- By gender (if data available)

---

## Output Format

### Team Records File Structure

```
data/records/
├── scy/
│   ├── records.md                  # All SCY records
│   ├── boys-10-under.md           # 10U boys records
│   ├── boys-11-12.md              # 11-12 boys records
│   ├── girls-10-under.md          # 10U girls records
│   └── ...
├── lcm/
│   └── records.md
├── scm/
│   └── records.md
├── top10/
│   ├── scy-50-free.md
│   └── ...
└── annual-summary-2025.md
```

### Markdown Format Example

```markdown
# Team Name - Short Course Yards Records

Last Updated: 2025-10-07

## Boys 13-14

### Freestyle
- **50 Free**: 21.45 - John Doe (14) - West Championships - 3/15/2024
- **100 Free**: 46.32 - Jane Smith (14) - State Meet - 2/22/2024
- **200 Free**: 1:42.15 - Bob Johnson (13) - Sectionals - 3/8/2023

### Backstroke
...
```

---

## Implementation Phases

### Phase 1: Research & Data Models ✅
- [x] Understand ford record generation
- [ ] Define event lists by course
- [ ] Define age group mapping
- [ ] Understand time parsing

### Phase 2: Core Record Generation Logic
- [ ] Read and combine swimmer data
- [ ] Filter for record-eligible swims
- [ ] Parse event names and extract stroke/distance
- [ ] Determine age at meet
- [ ] Group by course/age group/event
- [ ] Find best time per swimmer per category
- [ ] Handle ties

### Phase 3: Markdown Generation
- [ ] Create markdown templates
- [ ] Format times (seconds to MM:SS.SS)
- [ ] Format dates
- [ ] Add swim type indicators (†, ‡, ◊)
- [ ] Generate table of contents
- [ ] Add metadata

### Phase 4: CLI Integration
- [ ] Add generate command group
- [ ] Add records subcommand
- [ ] Add top10 subcommand
- [ ] Add annual subcommand
- [ ] Add course filters
- [ ] Add dry-run mode

### Phase 5: Testing & Documentation
- [ ] Test with real data
- [ ] Verify record calculations
- [ ] Update documentation
- [ ] Add examples

---

## Technical Considerations

### Event Parsing

Events come from API as strings like:
- "50 FR SCY"
- "100 BACK LCM"
- "200 IM SCM"

Need to parse:
- Distance (50, 100, 200, etc.)
- Stroke (FR, BACK, BREAST, FLY, IM)
- Course (SCY, LCM, SCM)

### Age Calculation

Age at meet needs to be calculated from:
- Swimmer's date of birth (if available)
- Or use Age column from API data

### Time Formatting

API returns times as strings:
- "21.45" → 21.45
- "1:42.15" → 1:42.15
- Need to handle both formats

### Swim Type Indicators

- † = Probationary (before joining team)
- ‡ = Relay leadoff
- ◊ = Prelims/Time Trial

---

## Questions to Resolve

1. How to handle swimmers without DOB?
2. Should we include relay times?
3. How to handle DQ (disqualified) swims?
4. What about exhibition swims?
5. Should we show second/third best times?

---

## Research from Ford Project

Need to examine:
- `scripts/generate_records.py` or similar
- How events are categorized
- How age groups are determined
- Markdown template format
- Time formatting logic

---

**Created:** 2025-10-07  
**Target Release:** v0.4.0
